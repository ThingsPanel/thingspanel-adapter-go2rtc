# ThingsPanel go2rtc Adapter

这是一个 ThingsPanel 的协议插件，用于集成 [go2rtc](https://github.com/AlexxIT/go2rtc) 流媒体服务器。
该插件允许通过 ThingsPanel 平台配置摄像头流（RTSP、RTMP 等），并通过插件自动注册到 go2rtc 中，实现流媒体的统一管理和分发。

## 功能特性

- **自动同步**: 监听 ThingsPanel 平台的设备配置变更，自动在 go2rtc 中添加或移除流。
- **双向同步**: 支持go2rtc → ThingsPanel的设备自动发现与注册
- **动态配置**: 支持通过平台界面配置流地址 (Stream URL) 和流名称。
- **流媒体集成**: 利用 go2rtc 的强大功能，支持 RTSP, RTMP, WebRTC, HLS 等多种协议。

## 平台配置指南

> **📖 完整配置文档**: [ThingsPanel配置指南.md](docs/ThingsPanel配置指南.md)

### 🔧 服务配置（应用管理 → 接入协议）

| 配置项 | 填写内容 | 说明 |
|--------|---------|------|
| 服务名称 | `Go2RTC流媒体适配器` | 自定义显示名称 |
| 服务标识符 | `OG-SZ501` | 必须与config.yaml一致 |
| 类别 | `服务接入` | 选择"服务接入" |
| 版本 | `1.0.0` | 插件版本号 |

### ⚙️ 插件配置（接入服务）

| 配置项 | Docker环境 | 宿主机环境 | 说明 |
|--------|-----------|-----------|------|
| HTTP服务地址 | `http://172.17.0.1:8081` | `http://127.0.0.1:8081` | 平台调用插件的地址 |
| 设备类型 | `直连设备` | `直连设备` | 固定选择 |
| 服务订阅主题前缀 | (留空) | (留空) | 不需要填写 |
| 设备接入地址 | `http://10.147.17.226:8081` | `http://10.147.17.226:8081` | 外部访问地址 |

> **⚠️ 重要**: HTTP服务地址在Docker环境必须使用 `172.17.0.1`，设备接入地址必须使用服务器实际IP

### 📡 服务接入点配置（三方接入）

| 配置项 | 填写内容 | 说明 |
|--------|---------|------|
| go2rtc API地址 | `http://localhost:1984` | go2rtc服务地址 |
| 同步间隔(秒) | `30` | 设备同步间隔 |
| 启用自动同步 | `开启` | 启用自动同步功能 |

### ✅ 验证配置

1. 确认服务在线: 进入"应用管理 → 接入协议"，确认 `OG-SZ501` 显示"在线"
2. 测试设备同步: 在go2rtc中添加stream，等待30秒后在"三方接入 → 设备列表"查看
3. 查看日志: `tail -f ~/tp-adapter/app.log | grep -i "sync\|设备"`

